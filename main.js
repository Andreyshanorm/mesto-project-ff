(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},t=function(e,t){var n=e.querySelectorAll("input");n&&n.forEach((function(e){e.classList.remove(t.inputErrorClass)}));var o=e.querySelectorAll("span");o&&o.forEach((function(e){e.classList.remove(t.errorClass),e.textContent=""}));var r=e.querySelector(t.submitButtonSelector);r&&(r.disabled=!0,r.classList.add("popup__button_disabled"))};function n(e,t){t.querySelector(".popup__button").textContent=e?"Сохранение":"Сохранить"}var o=document.querySelector(".popup_type_image"),r=o.querySelector(".popup__image"),a=o.querySelector(".popup__caption");function c(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&s(e),t.target.classList.contains("popup__close")&&s(e)}))}function i(e){e.querySelector(".card__image").addEventListener("click",(function(){return function(e){var t=e.querySelector("img").getAttribute("src"),n=e.querySelector("img").getAttribute("alt");r.src=t,r.alt=n,a.textContent=n,u(o)}(e)}))}function u(n){t(n,e),document.addEventListener("keydown",l),setTimeout((function(){n.classList.add("popup_is-opened")}),0),n.classList.add("popup_is-animated")}function s(n){setTimeout((function(){n.classList.remove("popup_is-animated")}),200),n.classList.remove("popup_is-opened"),t(n,e),document.removeEventListener("keydown",l)}function l(e){"Escape"===e.key&&s(document.querySelector(".popup_is-opened"))}var p=document.querySelector(".popup_type_edit"),d=document.querySelector(".popup_type_change_photo"),f=document.querySelector(".change__icon"),m=document.querySelector(".profile__edit-button"),_=document.querySelector(".popup_type_new-card"),y=document.querySelector(".profile__add-button"),v=document.querySelector('form[name="new-place"]'),h=document.querySelector('form[name="edit-profile"]'),S=(document.querySelector(".popup_type_image"),document.querySelectorAll(".popup")),b=function(e){var t=document.querySelector(".profile__title"),n=document.querySelector(".profile__description"),o=document.querySelector(".profile__image");t.textContent=e.name,n.textContent=e.about,o.src=e.avatar};function q(e,t){"d8460b2ac8963f12a63f7957"===t&&(j(e),setTimeout((function(){return location.reload()}),100))}function C(e,t,n){e.includes("d8460b2ac8963f12a63f7957")?(n.textContent=e.length,t.classList.add("is-active")):(t.classList.remove("is-active"),n.textContent=e.length)}function L(e,t,n){var o=t.classList.contains("is-active");T(e._id,o).then((function(e){C(e.likes.map((function(e){return e._id})),t,n)}))}var k=document.querySelector("#card-template").content,E=document.querySelector(".places__list");var g={baseUrl:"https://nomoreparties.co/v1/wff-cohort-6",headers:{authorization:"ae90b01c-4d6f-4fe0-9bc5-50249125af57","Content-Type":"application/json"}},j=function(e){fetch("".concat(g.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:g.headers.authorization,"Content-Type":"application/json"}}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.error(e)}))},T=function(e,t){return fetch("".concat(g.baseUrl,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:{authorization:g.headers.authorization,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.error(e)}))};Promise.all([fetch("".concat(g.baseUrl,"/users/me"),{method:"GET",headers:{authorization:g.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.error(e)})),fetch("".concat(g.baseUrl,"/cards"),{headers:{authorization:g.headers.authorization,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.error(e)}))]).then((function(e){var t={_id:e[0]._id,name:e[0].name,about:e[0].about,avatar:e[0].avatar},n=e[1].map((function(e){return{_id:e._id,name:e.name,link:e.link,likes:e.likes,owner:e.owner}}));b(t),function(e){e.forEach((function(e){E.append(function(e,t){var n=k.querySelector(".places__item").cloneNode(!0),o=n.querySelector(".card__image"),r=n.querySelector(".card__like-button"),a=n.querySelector(".card__delete-button"),c=n.querySelector(".likes__number");return t.openImagePopup(n),"d8460b2ac8963f12a63f7957"!==e.owner._id&&(a.disabled=!0,a.style.display="none"),C(e.likes.map((function(e){return e._id})),r,c),a.addEventListener("click",(function(){t.deleteCard(e._id,e.owner._id)})),r.addEventListener("click",(function(){t.likeCard(e,r,c)})),c.textContent=e.likes.length,o.src="".concat(e.link),o.alt=e.name,n.querySelector(".card__title").textContent=e.name,n}(e,{deleteCard:q,likeCard:L,openImagePopup:i}))}))}(n)}));var x=document.querySelector(".profile__title"),z=document.querySelector(".profile__description"),P=document.querySelector(".popup__input_type_name"),A=document.querySelector(".popup__input_type_description");var w,U,D,B,N;N=p,m.addEventListener("click",(function(){u(N),P.value="".concat(x.textContent),A.value="".concat(z.textContent)})),function(e,t){t.addEventListener("click",(function(){var t,n,o;n=(t=v).querySelector(".popup__input_type_card-name"),o=t.querySelector(".popup__input_type_url"),n.value="",o.value="",u(e)}))}(_,y),function(e,t){t.addEventListener("click",(function(){e.querySelector("input").value="",u(e)}))}(d,f),function(e){e.addEventListener("submit",(function(t){n(!0,e);var o={name:P.value,job:A.value,nameContainer:x,jobContainer:z};!function(e,t){e.preventDefault(),t.nameContainer.textContent=t.name,t.jobContainer.textContent=t.job,s(p)}(t,o),function(e,t,n){return fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:n.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.error(e)}))}(o.name,o.job,g).finally((function(){n(!1,e)}))}))}(h),U=(w=v).querySelector(".popup__input_type_card-name"),D=w.querySelector(".popup__input_type_url"),U.value="",w.addEventListener("submit",(function(e){n(!0,w),e.preventDefault();var t={name:U.value,link:D.value};!function(e,t,n){fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:{authorization:n.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.error(e)}))}(t.name,t.link,g),v.reset(),s(_),setTimeout((function(){return location.reload()}),100)})),function(e){var t=e.querySelector(".popup__input_type_avatar");t.value="",e.addEventListener("submit",(function(o){o.preventDefault(),n(!0,e),function(e,t){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.error(e)}))}(t.value,g).then((function(e){setTimeout((function(){b(e)}),300)})).finally((function(){n(!1,e)})),s(e)}))}(d),function(e){e.length>1?e.forEach(c):c(e)}(S),B=e,Array.from(document.querySelectorAll(B.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));e.querySelector("input"),n.forEach((function(o){o.addEventListener("input",(function(r){var a,c,i,u;a=e,c=o,i=t.inputErrorClass,u=t.errorClass,console.log(c),c.validity.patternMismatch?c.setCustomValidity(c.dataset.customError):c.setCustomValidity(""),c.validity.valid?function(e,t,n,o){console.log(e);var r=e.querySelector("#".concat(t.id,"-error"));r.classList.remove(o),r.textContent="",t.classList.remove(n)}(a,c,i,u):function(e,t,n,o,r){var a=e.querySelector("#".concat(t.id,"-error"));a.classList.add(r),a.textContent=n,t.classList.add(o)}(a,c,c.validationMessage,i,u),function(e,t,n,o){var r=e.querySelector("".concat(n));console.log(r),function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(r.disabled=!0,r.classList.add(o)):(r.disabled=!1,r.classList.remove(o))}(e,n,t.submitButtonSelector,t.inactiveButtonClass)}))}))}(e,B)}))})();