(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},t=function(e,t){var n=t.querySelector(".popup__button");e?(n.disabled=!1,n.classList.remove("popup__button_disabled")):n.classList.add("popup__button_disabled")},n=function(e,t){var n=e.querySelectorAll("input");n&&n.forEach((function(e){e.classList.remove(t.inputErrorClass)}));var o=e.querySelectorAll("span");o&&o.forEach((function(e){e.classList.remove(t.errorClass),e.textContent=""}));var r=e.querySelector(t.submitButtonSelector);r&&(r.disabled=!0,r.classList.add("popup__button_disabled"))},o=document.querySelector(".popup_type_image"),r=o.querySelector(".popup__image"),a=o.querySelector(".popup__caption");function c(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&s(e),t.target.classList.contains("popup__close")&&s(e)}))}function i(e){e.querySelector(".card__image").addEventListener("click",(function(){return function(e){var t=e.querySelector("img").getAttribute("src"),n=e.querySelector("img").getAttribute("alt");r.src=t,r.alt=n,a.textContent=n,u(o)}(e)}))}function u(t){n(t,e),document.addEventListener("keydown",l),setTimeout((function(){t.classList.add("popup_is-opened")}),0),t.classList.add("popup_is-animated")}function s(t){setTimeout((function(){t.classList.remove("popup_is-animated")}),800),t.classList.remove("popup_is-opened"),n(t,e),document.removeEventListener("keydown",l)}function l(e){"Escape"===e.key&&s(document.querySelector(".popup_is-opened"))}var p=document.querySelector(".popup_type_edit"),d=document.querySelector(".popup_type_change_photo"),_=document.querySelector(".change__icon"),f=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_new-card"),y=document.querySelector(".profile__add-button"),v=document.querySelector('form[name="new-place"]'),h=document.querySelector('form[name="edit-profile"]'),S=(document.querySelector(".popup_type_image"),document.querySelectorAll(".popup"));function b(e,t){"d8460b2ac8963f12a63f7957"===t&&(L(e),setTimeout((function(){return location.reload()}),100))}function q(e,t,n,o){var r=t.classList.contains("is-active");k(e,r).then((function(e){n.textContent=e,t.classList.toggle("is-active")}))}var C=document.querySelector("#card-template").content,g=document.querySelector(".places__list");var E={baseUrl:"https://nomoreparties.co/v1/wff-cohort-6",headers:{authorization:"ae90b01c-4d6f-4fe0-9bc5-50249125af57","Content-Type":"application/json"}},L=function(e){fetch("".concat(E.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:E.headers.authorization,"Content-Type":"application/json"}}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},k=function(e,t){return fetch("".concat(E.baseUrl,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:{authorization:E.headers.authorization,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e.likes.length})).catch((function(e){console.log(e)}))};Promise.all([fetch("".concat(E.baseUrl,"/users/me"),{headers:{authorization:E.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})),fetch("".concat(E.baseUrl,"/cards"),{headers:{authorization:E.headers.authorization,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))]).then((function(e){var t={_id:e[0]._id,name:e[0].name,about:e[0].about,avatar:e[0].avatar},n=e[1].map((function(e){return{_id:e._id,name:e.name,link:e.link,likes:e.likes,owner:e.owner}}));!function(e){var t=document.querySelector(".profile__title"),n=document.querySelector(".profile__description"),o=document.querySelector(".profile__image");t.textContent=e.name,n.textContent=e.about,o.src=e.avatar}(t),function(e){e.forEach((function(e){g.insertAdjacentElement("afterbegin",function(e,t,n){var o=C.querySelector(".places__item").cloneNode(!0),r=o.querySelector(".card__image"),a=o.querySelector(".card__like-button"),c=o.querySelector(".card__delete-button"),i=o.querySelector(".likes__number");return t.openImagePopup(o),"d8460b2ac8963f12a63f7957"!==e.owner._id&&(c.disabled=!0,c.style.display="none"),c.addEventListener("click",(function(){t.deleteCard(e._id,e.owner._id)})),a.addEventListener("click",(function(){t.likeCard(e._id,a,i,e.likes.length)})),i.textContent=e.likes.length,r.src="".concat(e.link),r.alt=e.name,o.querySelector(".card__title").textContent=e.name,o}(e,{deleteCard:b,likeCard:q,openImagePopup:i}))}))}(n)}));var j=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),T=document.querySelector(".popup__input_type_name"),z=document.querySelector(".popup__input_type_description");var P,A,w,U,D;D=p,f.addEventListener("click",(function(){u(D),T.value="".concat(j.textContent),z.value="".concat(x.textContent)})),function(e,t){t.addEventListener("click",(function(){var t,n,o;n=(t=v).querySelector(".popup__input_type_card-name"),o=t.querySelector(".popup__input_type_url"),n.value="",o.value="",u(e)}))}(m,y),function(e,t){t.addEventListener("click",(function(){e.querySelector("input").value="",u(e)}))}(d,_),function(e){e.addEventListener("submit",(function(e){var t={name:T.value,job:z.value,nameContainer:j,jobContainer:x};!function(e,t,n){fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:n.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t.name,t.job,E),function(e,t){e.preventDefault(),t.nameContainer.textContent=t.name,t.jobContainer.textContent=t.job,s(p)}(e,t)}))}(h),A=(P=v).querySelector(".popup__input_type_card-name"),w=P.querySelector(".popup__input_type_url"),A.value="",P.addEventListener("submit",(function(e){e.preventDefault();var t={name:A.value,link:w.value};!function(e,t,n){fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:{authorization:n.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t.name,t.link,E),v.reset(),s(m),setTimeout((function(){return location.reload()}),100)})),function(e){var t=e.querySelector(".popup__input_type_avatar");t.value="",e.addEventListener("submit",(function(n){n.preventDefault(),function(e,t){fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t.value,E),s(e)}))}(d),function(e){e.length>1?e.forEach(c):c(e)}(S),U=e,Array.from(document.querySelectorAll(U.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,n){Array.from(e.querySelectorAll(n.inputSelector)).forEach((function(e){e.addEventListener("input",(function(e){!function(e,n){var o=e.target,r=o.id,a=document.querySelector("#".concat(r,"-error")),c=o.parentNode;switch(o.type){case"url":o.validity.valid?(o.classList.remove(n.inputErrorClass),a.textContent="",t(!0,c)):(o.classList.add(n.inputErrorClass),a.textContent=o.validationMessage,t(!1,c));break;case"text":o.validity.valid?/^[a-zA-Zа-яА-ЯЁё\s-\,]*$/.test(e.target.value)?(o.classList.remove(n.inputErrorClass),a.textContent="",t(!0,c),console.log("сработало не то")):(o.classList.add(n.inputErrorClass),a.textContent=o.dataset.customError,t(!1,c)):(o.classList.add(n.inputErrorClass),a.textContent=o.validationMessage,t(!1,c))}}(e,n)}))}))}(e,U)}))})();